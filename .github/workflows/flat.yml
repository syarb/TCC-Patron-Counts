on:
  workflow_dispatch: {}
  push:
    paths:
      - .github/workflows/flat.yml
  schedule:
    - cron: "*/5 * * * *"
jobs:
  scheduled:
    runs-on: ubuntu-latest
    steps:
      - name: Setup deno
        uses: denoland/setup-deno@main
        with:
          deno-version: v1.x
      - name: Check out repo
        uses: actions/checkout@v2
      - name: Fetch data
        uses: githubocto/flat@v3
        with:
          http_url: https://docs.google.com/spreadsheets/d/e/2PACX-1vS3dDNdq7_r43CaeRlJO8ZPsnwHtL6VjkrF0m7UiQkoEaexpZiSu5iQ1rmNuBh0W3Lh_P7G3y4njXcw/pub?gid=0&single=true&output=csv
          downloaded_filename: Current Semester - Southeast.csv
      - name: Fetch data
        uses: githubocto/flat@v3
        with:
          http_url: https://docs.google.com/spreadsheets/d/e/2PACX-1vQxy6ICXRZB3edlwzWbv90tPd4f0veX0ML7bb60O96eABCer6ghyBS2YG0YJWKSkQPDIsrWNTRkBCop/pub?gid=0&single=true&output=csv
          downloaded_filename: Current Semester - Metro.csv
  build:
    # The type of runner that the job will run on
    runs-on: ubuntu-latest

    # Steps represent a sequence of tasks that will be executed as part of the job
    steps:
      # Checks-out your repository under $GITHUB_WORKSPACE, so your job can access it
      - uses: actions/checkout@v2

      - name: Automatic Releases
        # You may pin to the exact commit or the version.
        # uses: marvinpinto/action-automatic-releases@526ce12c6675bbe6e0e9a4169c90d09a3f7ad3e2
        uses: marvinpinto/action-automatic-releases@v1.2.0
        with:
          # GitHub secret token
          repo_token: "${{ secrets.GITHUB_TOKEN }}"
          # Git tag (for automatic releases)
          automatic_release_tag: latest # optional
          # Should this release be marked as a draft?
          draft: false # optional
          # Should this release be marked as a pre-release?
          prerelease: false # optional, default is true
          # Release title (for automatic releases)
          title: Latest Patron Counts # optional
          # Assets to upload to the release
          files: |
            Current Semester - Metro.csv
            Current Semester - Southeast.csv
            Previous Semesters.csv
